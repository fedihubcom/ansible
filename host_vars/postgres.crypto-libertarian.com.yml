---
ansible_become_pass_for:
  kotovalexarian: !vault |
    $ANSIBLE_VAULT;1.2;AES256;kotovalexarian
    61623634613531666632363233346539303131313038666132643464313263356162616661336339
    6437356339396139346435636462613163396332313135620a383962643839393764616130663264
    39363331653837376434613266623331333563343264383365336234666230633334313338623938
    3562303035333732360a393931353339653539323732316137363532316234306461393265633763
    64343336303765646239386265306435323230303764376439346530646138323137333461383766
    3534613339653530643635316531356166313735623339613937
  xuhcc: !vault |
    $ANSIBLE_VAULT;1.2;AES256;xuhcc
    33343933353961653437653139333435306663383434646339353763303530353731383438653337
    3531393762396135366332396632653036346333623133650a306162326438333931303862383330
    39626564333130623731343339663764643632323566393734346565353934656561386462326434
    6538303365386631640a366330333135313464333962313638643465613836643037323833626131
    39623562376439376665636537396339613462356131343763323437623334323463

ansible_become_pass: "{{ ansible_become_pass_for[admin] }}"

common__certbot__cert_name: 'postgres.crypto-libertarian.com'
common__certbot__cert_domains:
  - 'postgres.crypto-libertarian.com'
common__certbot__post_hook: null
common__certbot__pre_hook: null

postgresql_users:
  - name: matrix_synapse
    password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      35643162356165376337313538396466333534613666323865636363656264373539646135303136
      3263643435383866643161333931383430313133633331370a636639303366616132616164306537
      31333162356131633635303931353931633763386238636461343437363861343565616430666137
      3738616138303739350a646331323639306464656332383233333664653561313934666366623939
      65373839653630353830326336376534313136313735343532373232653536653363366132333363
      6639346134356664313434373664653734366361633935633230

postgresql_databases:
  - name: matrix_synapse
    owner: matrix_synapse
    lc_collate: C
    lc_ctype: C

postgresql_hba_entries:
  - type: local
    database: all
    user: all
    auth_method: peer

  - type: host
    database: all
    user: all
    address: '127.0.0.1/32'
    auth_method: md5

  - type: host
    database: all
    user: all
    address: '::1/128'
    auth_method: md5

  - type: hostssl
    database: matrix_synapse
    user: matrix_synapse
    address: '134.209.196.172/32'
    auth_method: md5

  - type: hostssl
    database: matrix_synapse
    user: matrix_synapse
    address: '2a03:b0c0:2:f0::142:3001/128'
    auth_method: md5

  - type: hostssl
    database: matrix_synapse
    user: matrix_synapse
    address: '10.133.8.214/32'
    auth_method: md5

  - type: host
    database: all
    user: all
    address: '0.0.0.0/0'
    auth_method: reject

  - type: host
    database: all
    user: all
    address: '::/0'
    auth_method: reject

common__iptables__v4_filter: |
  # Allow incoming PostgreSQL from specific hosts.
  -A INPUT  -p tcp --dport 5432 -s 134.209.196.172/32 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
  -A OUTPUT -p tcp --sport 5432 -d 134.209.196.172/32 -m conntrack --ctstate ESTABLISHED     -j ACCEPT
  -A INPUT  -p tcp --dport 5432 -s 10.133.8.214/32    -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
  -A OUTPUT -p tcp --sport 5432 -d 10.133.8.214/32    -m conntrack --ctstate ESTABLISHED     -j ACCEPT

  # Deny other PostgreSQL.
  -A INPUT  -p tcp --dport 5432 -j REJECT
  -A OUTPUT -p tcp --sport 5432 -j REJECT

common__iptables__v6_filter: |
  # Allow incoming PostgreSQL from specific hosts.
  -A INPUT  -p tcp --dport 5432 -s 2a03:b0c0:2:f0::142:3001/128 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
  -A OUTPUT -p tcp --sport 5432 -d 2a03:b0c0:2:f0::142:3001/128 -m conntrack --ctstate ESTABLISHED     -j ACCEPT

  # Deny other PostgreSQL.
  -A INPUT  -p tcp --dport 5432 -j REJECT
  -A OUTPUT -p tcp --sport 5432 -j REJECT
